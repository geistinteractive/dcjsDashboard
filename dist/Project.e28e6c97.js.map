{"version":3,"sources":["index.js"],"names":["print_filter","filter","f","eval","length","top","Infinity","dimension","d","console","log","JSON","stringify","replace","typeCodes","Complaint","Scheduling","Solicitor","threeChartHeight","dayFormat","d3","timeFormat","numFormatLg","format","numFormat","monthName","monthFormat","remove_empty_bins","source_group","all","value","removeTypes_Empty","current","previous","setIntoYears","sourceGroup","window","loadData","json","typeAdd","i","Year","Dept","typeRemove","typeInitial","currentYr","Date","getFullYear","previousYr","data","parse","forEach","theDate","fieldData","CreationTimestamp","currDate","Type","Call_Log_Type","split","join","Call_Log_Department","Day","Month","getMonth","facts","crossfilter","depts","map","getUniqueDepts","index","self","indexOf","lengthDepts","allCallsDim","allCallsGroup","group","deptDim","deptGroup","reduceCount","deptByTypeDim","deptByTypeGroup","reduce","deptByPersonDim","CreatedBy","deptByPersonGroup","typeDim","typeGroup","createdByDim","createdByGroup","monthDim","monthGroup","reducePeriodAdd","reducePeriodRemove","reducePeriodInitial","sel_stack","state","chartAllCalls","dc","rowChart","overviewComposite","compositeChart","overviewCurrent","lineChart","overviewPrevious","chartCallsByType","chartCallsByPerson","pieChart","chartCallsByDept","chartDeptByTypeTwoYears","chartDeptByTypeCurrent","barChart","chartDeptByTypePrevious","chartDeptByPersonTwoYears","chartDeptByPersonCurrent","chartDeptByPersonPrevious","document","querySelector","clientWidth","gap","centerBar","elasticX","ordinalColors","schemeOranges","on","chart","selectAll","style","title","key","layer","stack","schemeGreens","height","xAxisPadding","shareTitle","legend","x","y","autoItemWidth","itemHeight","itemWidth","horizontal","_rangeBandPadding","scaleBand","xUnits","units","ordinal","brushOn","elasticY","compose","renderLabel","colors","curve","curveMonotoneX","valueAccessor","renderHorizontalGridLines","renderVerticalGridLines","scaleOrdinal","obj","fixedBarHeight","innerRadius","slicesCap","schemePaired","legendText","name","text","utils","printSingleValue","endAngle","startAngle","Math","PI","schemeTableau10","monthNames","xAxis","tickFormat","m","yAxis","n","clipPadding","renderAll"],"mappings":";AAEA,SAASA,aAAaC,QAChBC,IAAAA,EAAIC,KAAKF,QACFC,EAAEE,YAGO,IAATF,EAAEG,MACXH,EAAIA,EAAEG,IAAIC,EAAAA,SAGc,IAAfJ,EAAEK,YACXL,EAAIA,EACDK,UAAU,SAAUC,GACZ,MAAA,KAERH,IAAIC,EAAAA,IAGTG,QAAQC,IACNT,OACE,IACAC,EAAEE,OACF,OACAO,KAAKC,UAAUV,GACZW,QAAQ,IAAK,SACbA,QAAQ,OAAQ,UAChBA,QAAQ,IAAK,QAItB,IAAIC,UAAY,CACI,iBAAA,UACE,mBAAA,SACH,gBAAA,SACE,kBAAA,WACD,iBAAA,UACA,iBAAA,UAClBC,UAAW,OACY,sBAAA,QACH,mBAAA,QACF,iBAAA,QACE,mBAAA,UACC,oBAAA,SACa,iCAAA,SACb,oBAAA,SACA,oBAAA,YACJ,gBAAA,UACE,kBAAA,UACA,kBAAA,UACW,6BAAA,UAC9BC,WAAY,MACZC,UAAW,MACY,sBAAA,cACO,6BAAA,eAG5BC,iBAAmB,IAEnBC,UAAYC,GAAGC,WAAW,MAC1BC,YAAcF,GAAGG,OAAO,MACxBC,UAAYJ,GAAGG,OAAO,KACtBE,UAAYL,GAAGC,WAAW,MAC1BK,YAAcN,GAAGC,WAAW,MAChC,SAASM,kBAAkBC,GAClB,MAAA,CACLC,IAAK,WACID,OAAAA,EAAaC,MAAM5B,OAAO,SAAUO,GAClCA,OAAW,GAAXA,EAAEsB,UAMjB,SAASC,kBAAkBH,GAClB,MAAA,CACLC,IAAK,WACID,OAAAA,EAAaC,MAAM5B,OAAO,SAAUO,GAClCA,OAAAA,EAAEsB,QAAU,CAAEE,QAAS,GAAIC,SAAU,QAKpD,SAASC,aAAaC,GACb,MAAA,CACLN,IAAK,WACIM,OAAAA,EAAYN,MAAM5B,SAK/BmC,OAAOC,SAAW,SAAUC,GA0BjBC,SAAAA,EAAQC,EAAGhC,GAOXgC,OANQ,OAAXhC,EAAEiC,KACJD,EAAER,QAAQxB,EAAEkC,QAAUF,EAAER,QAAQxB,EAAEkC,OAAS,EAE3CF,EAAEP,SAASzB,EAAEkC,QAAUF,EAAEP,SAASzB,EAAEkC,OAAS,EAGxCF,EAGAG,SAAAA,EAAWH,EAAGhC,GAOdgC,OANQ,OAAXhC,EAAEiC,KACJD,EAAER,QAAQxB,EAAEkC,QAAUF,EAAER,QAAQxB,EAAEkC,OAAS,EAE3CF,EAAEP,SAASzB,EAAEkC,QAAUF,EAAEP,SAASzB,EAAEkC,OAAS,EAGxCF,EAEAI,SAAAA,EAAYJ,EAAGhC,GACf,MAAA,CAAEwB,QAAS,GAAIC,SAAU,IAO9BY,IAAAA,GAAY,IAAIC,MAAOC,cACvBC,EAAaH,EAAY,EAIzBI,EAAOtC,KAAKuC,MAAMZ,GAEtBW,EAAKE,QAAQ,SAAU3C,EAAGgC,GACpBY,IAAAA,EAAU5C,EAAE6C,UAAUC,kBACtBC,EAAW,IAAIT,KAAKM,GAExB5C,EAAEsC,KAAOS,EACT/C,EAAEiC,KAAOjC,EAAEsC,KAAKC,cAChBvC,EAAEgD,KAAO1C,UAAUN,EAAE6C,UAAUI,eAAeC,MAAM,KAAKC,KAAK,IAC9DnD,EAAEkC,KAAOlC,EAAE6C,UAAUO,oBACrBpD,EAAEqD,IAAM1C,UAAUoC,GAClB/C,EAAEsD,MAAQP,EAASQ,aAGjBC,IAAAA,EAAQC,YAAYhB,GAEpBiB,EAAQjB,EACTkB,IAAI,SAAU3D,GACNA,OAAAA,EAAE6C,UAAUO,sBAEpB3D,OA7BMmE,SAAetC,EAAOuC,EAAOC,GAC7BA,OAAAA,EAAKC,QAAQzC,KAAWuC,IA6B7BG,EAAcN,EAAM9D,OAIpBqE,EAAcT,EAAMzD,UAAU,SAAUC,GACnCA,OAAAA,EAAEiC,OAEPiC,EAAgBD,EAAYE,QAG5BC,EAAUZ,EAAMzD,UAAU,SAAUC,GAC/BA,OAAAA,EAAEkC,OAEPmC,EAAYD,EAAQD,QAAQG,cAG5BC,EAAgBf,EAAMzD,UAAU,SAAUC,GACrCA,OAAAA,EAAEgD,OAEPwB,EAAkBD,EACnBJ,QACAM,OAAO1C,EAASI,EAAYC,GAG3BsC,EAAkBlB,EAAMzD,UAAU,SAAUC,GACvCA,OAAAA,EAAE6C,UAAU8B,YAEjBC,EAAoBF,EACrBP,QACAM,OAAO1C,EAASI,EAAYC,GAE3ByC,EAAUrB,EAAMzD,UAAU,SAAUC,GAC/BA,OAAAA,EAAE6C,UAAUI,gBAEjB6B,EAAYD,EAAQV,QAAQG,YAAY,SAAUtE,GAC7CA,OAAAA,EAAEiD,gBAIP8B,EAAevB,EAAMzD,UAAU,SAAUC,GACpCA,OAAAA,EAAE6C,UAAU8B,YAEjBK,EAAiBD,EAAaZ,QAE9Bc,EAAWzB,EAAMzD,UAAU,SAAUC,GAChCA,OAAAA,EAAEsD,QAGP4B,EAAaD,EACdd,QACAM,OA/HMU,SAAgBnD,EAAGhC,GAOnBgC,OALQ,OAAXhC,EAAEiC,OACFD,EAAER,UAEFQ,EAAEP,SAECO,GAEAoD,SAAmBpD,EAAGhC,GAMtBgC,OALQ,OAAXhC,EAAEiC,OACFD,EAAER,UAEFQ,EAAEP,SAECO,GAGAqD,SAAoBrD,EAAGhC,GACvB,MAAA,CACLwB,QAAS,EACTC,SAAU,KAkIL6D,SAAAA,EAAUtD,EAAGuD,GACb,OAAA,SAAUvF,GACRA,OAAAA,EAAEsB,MAAMiE,GAAOvD,IAAM,GAtBhCJ,OAAO4D,cAAgBC,GAAGC,SAAS,aAEnC9D,OAAO+D,kBAAoBF,GAAGG,eAAe,aAC7ChE,OAAOiE,gBAAkBJ,GAAGK,UAAUH,mBACtC/D,OAAOmE,iBAAmBN,GAAGK,UAAUH,mBACvC/D,OAAOoE,iBAAmBP,GAAGC,SAAS,qBACtC9D,OAAOqE,mBAAqBR,GAAGS,SAAS,uBACxCtE,OAAOuE,iBAAmBV,GAAGS,SAAS,2BACtCtE,OAAOwE,wBAA0BX,GAAGG,eAClC,4BAEFhE,OAAOyE,uBAAyBZ,GAAGa,SAASF,yBAC5CxE,OAAO2E,wBAA0Bd,GAAGa,SAASF,yBAE7CxE,OAAO4E,0BAA4Bf,GAAGG,eACpC,8BAEFhE,OAAO6E,yBAA2BhB,GAAGa,SAASE,2BAC9C5E,OAAO8E,0BAA4BjB,GAAGa,SAASE,2BAC/CvG,QAAQC,IAAIyG,SAASC,cAAc,4BAA4BC,aAQ/DR,uBAEGS,IAAI,IACJC,WAAU,GACVC,UAAS,GACTC,cAAcrG,GAAGsG,cAAc,IAC/BC,GAAG,gBAAiB,SAAUC,GAC7BA,EAAMC,UAAU,YAAYC,MAAM,QAAS,SAAUtH,GAC5C,MAAA,WAGVuH,MAAM,SAAUvH,GAEbqC,OAAAA,EACA,IACArC,EAAEwH,IACF,IACA,KAAKC,MACL,KACAzH,EAAEsB,MAAME,QAAQ,KAAKiG,SAGxBtD,MAAMK,EAAiBd,EAAM,GAAI4B,EAAU5B,EAAM,GAAI,YAEnD,IAAA,IAAI1B,EAAI,EAAGA,EAAIgC,IAAehC,EACjCqE,uBAAuBqB,MACrBlD,EACA,GAAKd,EAAM1B,GACXsD,EAAU5B,EAAM1B,GAAI,YAGxBuE,wBACGgB,MAAM,SAAUvH,GAEbwC,OAAAA,EACA,IACAxC,EAAEwH,IACF,IACA,KAAKC,MACL,KACAzH,EAAEsB,MAAMG,SAAS,KAAKgG,SAGzBV,WAAU,GACVE,cAAcrG,GAAG+G,aAAa,IAC9BX,UAAS,GAET7C,MAAMK,EAAiBd,EAAM,GAAI4B,EAAU5B,EAAM,GAAI,aAGnD,IAAI1B,EAAI,EAAGA,EAAIgC,IAAehC,EACjCuE,wBAAwBmB,MACtBlD,EACA,GAAKd,EAAM1B,GACXsD,EAAU5B,EAAM1B,GAAI,aAGxBoE,wBACGwB,OAAO,KACPC,aAAa,KACbC,YAAW,GACXC,OACCtC,GACGsC,SACAC,EAAE,KACFC,EAAE,GACFC,eAAc,GACdC,WAAW,IACXC,UAAU,KACVtB,IAAI,GACJuB,YAAW,IAEfC,kBAAkB,GAClBN,EAAEpH,GAAG2H,aACLC,OAAO/C,GAAGgD,MAAMC,SAChB3I,UAAUwE,GACVJ,MAAMK,GACNmE,SAAQ,GACRC,UAAS,GAETf,cAAa,GACbc,SAAQ,GACRE,QAAQ,CAACtC,wBAAyBF,yBAGrCI,yBAEGK,IAAI,IACJC,WAAU,GACV+B,aAAY,GACZ7B,cAAcrG,GAAGsG,cAAc,IAC/BC,GAAG,gBAAiB,SAAUC,GAC7BA,EAAMC,UAAU,YAAYC,MAAM,QAAS,SAAUtH,GAC5C,MAAA,WAGVuH,MAAM,SAAUvH,GAEbqC,OAAAA,EACA,IACArC,EAAEwH,IACF,IACA,KAAKC,MACL,KACAzH,EAAEsB,MAAME,QAAQ,KAAKiG,SAGxBtD,MAAMS,EAAmBlB,EAAM,GAAI4B,EAAU5B,EAAM,GAAI,YAGrD,IAAI1B,EAAI,EAAGA,EAAIgC,IAAehC,EACjCyE,yBAAyBiB,MACvB9C,EACA,GAAKlB,EAAM1B,GACXsD,EAAU5B,EAAM1B,GAAI,YAIxB0E,0BAEGO,cAAcrG,GAAG+G,aAAa,IAC9BZ,WAAU,GAEVQ,MAAM,SAAUvH,GAEbwC,OAAAA,EACA,IACAxC,EAAEwH,IACF,IACA,KAAKC,MACL,KACAzH,EAAEsB,MAAMG,SAAS,KAAKgG,SAGzBtD,MAAMS,EAAmBlB,EAAM,GAAI4B,EAAU5B,EAAM,GAAI,aAGrD,IAAI1B,EAAI,EAAGA,EAAIgC,IAAehC,EACjC0E,0BAA0BgB,MACxB9C,EACA,GAAKlB,EAAM1B,GACXsD,EAAU5B,EAAM1B,GAAI,aAGxBwE,0BACGoB,OAAO,KACPE,YAAW,GACXC,OACCtC,GACGsC,SACAC,EAAE,KACFC,EAAE,GACFC,eAAc,GACdC,WAAW,IACXC,UAAU,KACVtB,IAAI,GACJuB,YAAW,IAEfC,kBAAkB,GAClBN,EAAEpH,GAAG2H,aACLC,OAAO/C,GAAGgD,MAAMC,SAEhB3I,UAAU2E,GACVP,MAAMS,GACN+D,SAAQ,GACRC,UAAS,GAETf,cAAa,GACbc,SAAQ,GACRE,QAAQ,CAACnC,0BAA2BD,2BAEvCZ,gBACGkD,OArRgB,UAsRhB5E,MAAMe,EAAY,GAAK7C,GACvB2G,MAAMpI,GAAGqI,gBACTH,aAAY,GACZI,cAAc,SAAUlJ,GAChBA,OAAAA,EAAEsB,MAAME,UAGnBuE,iBACGgD,OA7RiB,SA8RjBC,MAAMpI,GAAGqI,gBACTH,aAAY,GACZ3E,MAAMe,EAAY,GAAK1C,GACvB0G,cAAc,SAAUlJ,GAChBA,OAAAA,EAAEsB,MAAMG,WAGnBkE,kBACGiC,OAAO,KACPuB,2BAA0B,GAC1BC,yBAAwB,GACxBpB,EAAEpH,GAAGyI,gBACLb,OAAO/C,GAAGgD,MAAMC,SAEhB3I,UAAUkF,GACVd,MAAMe,GACN8B,UAAS,GACT4B,UAAS,GACTN,kBAAkB,GAClBK,SAAQ,GACRpB,MAAM,SAAUvH,GASRsJ,OAPLjH,EACA,KACArC,EAAEsB,MAAME,QACR,KACAgB,EACA,KACAxC,EAAEsB,MAAMG,WAGXoH,QAAQ,CAAChD,gBAAiBE,mBAE7BC,iBACGjG,UAAU8E,GACViE,aAAY,GACZ9B,UAAS,GACT7C,MAAMW,GACN8C,OAAOlH,kBACPsH,EAAEpH,GAAGyI,gBAER7D,cACGzF,UAAUkE,GACVgD,cAAc,CAzUG,QADD,WA2UhBc,OAAOtC,GAAGsC,SAASC,EAAE,IAAIC,EAAE,IAAIE,WAAW,IAAIrB,IAAI,GAAGuB,YAAW,IAChEkB,eAAe,IACfT,aAAY,GACZ9B,UAAS,GACT7C,MAAMD,GACN0D,OAAO,KACPI,EAAEpH,GAAGyI,gBAERpD,mBACGlG,UAAUgF,GACVZ,MAAMa,GACNwE,YAAY,IACZ5B,OAAO,KACP6B,UAAU,GACVxC,cAAcrG,GAAG8I,cACjB3B,OACCtC,GAAGsC,SAAS4B,WAAW,SAAU3J,GAExBA,OAAAA,EAAE4J,KAAO,OAAS5I,UAAUhB,EAAEyC,SAGxC8E,MAAM,SAAUvH,GACRgB,OAAAA,UAAUhB,EAAEsB,SAEpB6F,GAAG,gBAAiB,SAAUC,GAC7BA,EAAMC,UAAU,kBAAkBwC,KAAK,SAAU7J,GACvCA,EAAEyC,KAAK+E,IACPxH,EAAEyC,KAAKnB,MAERmE,OAAAA,GAAGqE,MAAMC,iBACdnJ,GAAGG,OAAO,MAAVH,EAAkBZ,EAAEgK,SAAWhK,EAAEiK,aAAe,EAAIC,KAAKC,UAKjEhE,iBACGpG,UAAUqE,GACVD,MAAME,GACNmF,YAAY,IACZ5B,OAAO,KACPL,MAAM,SAAUvH,GACRgB,OAAAA,UAAUhB,EAAEsB,SAEpBmI,UAAU,GACVxC,cAAcrG,GAAGwJ,iBACjBrC,OACCtC,GAAGsC,SAAS4B,WAAW,SAAU3J,GAExBA,OAAAA,EAAE4J,KAAO,OAAS5I,UAAUhB,EAAEyC,SAGxC0E,GAAG,gBAAiB,SAAUC,GAC7BA,EAAMC,UAAU,kBAAkBwC,KAAK,SAAU7J,GACvCA,EAAEyC,KAAK+E,IACPxH,EAAEyC,KAAKnB,MAERmE,OAAAA,GAAGqE,MAAMC,iBACdnJ,GAAGG,OAAO,MAAVH,EAAkBZ,EAAEgK,SAAWhK,EAAEiK,aAAe,EAAIC,KAAKC,UAI7DE,IAAAA,EAAa,CACf,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OAGF1E,kBAAkB2E,QAAQC,WAAW,SAAUC,GACtCH,OAAAA,EAAWG,KAEpBhE,0BAA0BiE,QAAQF,WAAW,SAAUG,GAC9C5J,OAAAA,YAAY4J,KAErB/E,kBAAkB8E,QAAQF,WAAW,SAAUG,GACtC5J,OAAAA,YAAY4J,KAErBtE,wBAAwBqE,QAAQF,WAAW,SAAUG,GAC5C5J,OAAAA,YAAY4J,KAErB/E,kBAAkBgF,YAAY,KAC9BlF,GAAGmF","file":"Project.e28e6c97.js","sourceRoot":"..","sourcesContent":["// import theData from \"./data.json\";\n\nfunction print_filter(filter) {\n  var f = eval(filter);\n  if (typeof f.length != \"undefined\") {\n  } else {\n  }\n  if (typeof f.top != \"undefined\") {\n    f = f.top(Infinity);\n  } else {\n  }\n  if (typeof f.dimension != \"undefined\") {\n    f = f\n      .dimension(function (d) {\n        return \"\";\n      })\n      .top(Infinity);\n  } else {\n  }\n  console.log(\n    filter +\n      \"(\" +\n      f.length +\n      \") = \" +\n      JSON.stringify(f)\n        .replace(\"[\", \"[\\n\\t\")\n        .replace(/}\\,/g, \"},\\n\\t\")\n        .replace(\"]\", \"\\n]\")\n  );\n}\n\nvar typeCodes = {\n  \"Approve Repair\": \"App Rep\",\n  \"Billing Question\": \"Bill Q\",\n  \"Call for Eric\": \"C Eric\",\n  \"Call for Harvey\": \"C Harvey\",\n  \"Cancel Repair \": \"Can Rep\",\n  \"Cancel Service\": \"Can Ser\",\n  Complaint: \"Comp\",\n  \"Compliment - KUDDOS\": \"Kudos\",\n  \"General Question\": \"Gen Q\",\n  \"Question - BBQ\": \"Q BBQ\",\n  \"Question - Chems\": \"Q Chems\",\n  \"Question - Orders\": \"Q Ords\",\n  \"Question - Pool Cleaner Repair\": \"Q Pool\",\n  \"Questions - Parts\": \"Q Part\",\n  \"Recent Repair Bad\": \"Rec Rep B\",\n  \"Request Quote\": \"Req Qte\",\n  \"Requires Action\": \"Req Act\",\n  \"Schedule Repair\": \"Scd Rep\",\n  \"Schedule Repair **RETAIL**\": \"Scd Ret\",\n  Scheduling: \"Scd\",\n  Solicitor: \"Sol\",\n  \"Urgent - Const Call\": \"!Const Call\",\n  \"Urgent - Sales Please Call\": \"!Sales Call\",\n};\n\nvar threeChartHeight = 400;\n\nvar dayFormat = d3.timeFormat(\"%d\");\nvar numFormatLg = d3.format(\"~s\");\nvar numFormat = d3.format(\",\");\nvar monthName = d3.timeFormat(\"%B\");\nvar monthFormat = d3.timeFormat(\"%m\");\nfunction remove_empty_bins(source_group) {\n  return {\n    all: function () {\n      return source_group.all().filter(function (d) {\n        return d.value != 0;\n      });\n    },\n  };\n}\n\nfunction removeTypes_Empty(source_group) {\n  return {\n    all: function () {\n      return source_group.all().filter(function (d) {\n        return d.value === { current: {}, previous: {} };\n      });\n    },\n  };\n}\nfunction setIntoYears(sourceGroup) {\n  return {\n    all: function () {\n      return sourceGroup.all().filter;\n    },\n  };\n}\n\nwindow.loadData = function (json) {\n  //Reduce functions\n  function reducePeriodAdd(i, d) {\n    // console.log(d.Year);\n    if (d.Year === 2020) {\n      ++i.current;\n    } else {\n      ++i.previous;\n    }\n    return i;\n  }\n  function reducePeriodRemove(i, d) {\n    if (d.Year === 2020) {\n      --i.current;\n    } else {\n      --i.previous;\n    }\n    return i;\n  }\n\n  function reducePeriodInitial(i, d) {\n    return {\n      current: 0,\n      previous: 0,\n    };\n  }\n  function typeAdd(i, d) {\n    if (d.Year === 2020) {\n      i.current[d.Dept] = ++i.current[d.Dept] || 1;\n    } else {\n      i.previous[d.Dept] = ++i.previous[d.Dept] || 1;\n    }\n\n    return i;\n  }\n\n  function typeRemove(i, d) {\n    if (d.Year === 2020) {\n      i.current[d.Dept] = --i.current[d.Dept] || 0;\n    } else {\n      i.previous[d.Dept] = --i.previous[d.Dept] || 0;\n    }\n\n    return i;\n  }\n  function typeInitial(i, d) {\n    return { current: {}, previous: {} };\n  }\n\n  function getUniqueDepts(value, index, self) {\n    return self.indexOf(value) === index;\n  }\n  //Set variables\n  var currentYr = new Date().getFullYear();\n  var previousYr = currentYr - 1;\n  var currentColor = \"orange\";\n  var previousColor = \"green\";\n  //Configure data\n  var data = JSON.parse(json);\n\n  data.forEach(function (d, i) {\n    var theDate = d.fieldData.CreationTimestamp;\n    var currDate = new Date(theDate);\n    // console.log(currDate);\n    d.Date = currDate;\n    d.Year = d.Date.getFullYear();\n    d.Type = typeCodes[d.fieldData.Call_Log_Type].split(\" \").join(\"\");\n    d.Dept = d.fieldData.Call_Log_Department;\n    d.Day = dayFormat(currDate);\n    d.Month = currDate.getMonth();\n  });\n\n  var facts = crossfilter(data);\n  //Get unique departments\n  var depts = data\n    .map(function (d) {\n      return d.fieldData.Call_Log_Department;\n    })\n    .filter(getUniqueDepts);\n  var lengthDepts = depts.length;\n\n  //DIMENSION ****************************************\n  //ALL CALLS\n  var allCallsDim = facts.dimension(function (d) {\n    return d.Year;\n  });\n  var allCallsGroup = allCallsDim.group();\n\n  //DEPTARTMENTS\n  var deptDim = facts.dimension(function (d) {\n    return d.Dept;\n  });\n  var deptGroup = deptDim.group().reduceCount();\n\n  //DEPT by TYPE\n  var deptByTypeDim = facts.dimension(function (d) {\n    return d.Type;\n  });\n  var deptByTypeGroup = deptByTypeDim\n    .group()\n    .reduce(typeAdd, typeRemove, typeInitial);\n\n  //DEPT by PERSON\n  var deptByPersonDim = facts.dimension(function (d) {\n    return d.fieldData.CreatedBy;\n  });\n  var deptByPersonGroup = deptByPersonDim\n    .group()\n    .reduce(typeAdd, typeRemove, typeInitial);\n  //TYPE DIMENSION\n  var typeDim = facts.dimension(function (d) {\n    return d.fieldData.Call_Log_Type;\n  });\n  var typeGroup = typeDim.group().reduceCount(function (d) {\n    return d.Call_Log_Type;\n  });\n\n  //PERSON DIMENSION\n  var createdByDim = facts.dimension(function (d) {\n    return d.fieldData.CreatedBy;\n  });\n  var createdByGroup = createdByDim.group();\n\n  var monthDim = facts.dimension(function (d) {\n    return d.Month;\n  });\n\n  var monthGroup = monthDim\n    .group()\n    .reduce(reducePeriodAdd, reducePeriodRemove, reducePeriodInitial);\n\n  // var yearPrev = yearCurrent - 1;\n\n  window.chartAllCalls = dc.rowChart(\"#allCalls\");\n\n  window.overviewComposite = dc.compositeChart(\"#overview\");\n  window.overviewCurrent = dc.lineChart(overviewComposite);\n  window.overviewPrevious = dc.lineChart(overviewComposite);\n  window.chartCallsByType = dc.rowChart(\"#chartCallsByType\");\n  window.chartCallsByPerson = dc.pieChart(\"#chartCallsByPerson\");\n  window.chartCallsByDept = dc.pieChart(\"#chartCallsByDepartment\");\n  window.chartDeptByTypeTwoYears = dc.compositeChart(\n    \"#chartDeptByTypeTwoYears\"\n  );\n  window.chartDeptByTypeCurrent = dc.barChart(chartDeptByTypeTwoYears);\n  window.chartDeptByTypePrevious = dc.barChart(chartDeptByTypeTwoYears);\n\n  window.chartDeptByPersonTwoYears = dc.compositeChart(\n    \"#chartDeptByPersonTwoYears\"\n  );\n  window.chartDeptByPersonCurrent = dc.barChart(chartDeptByPersonTwoYears);\n  window.chartDeptByPersonPrevious = dc.barChart(chartDeptByPersonTwoYears);\n  console.log(document.querySelector(\"#chartDeptByTypeTwoYears\").clientWidth);\n  function sel_stack(i, state) {\n    return function (d) {\n      return d.value[state][i] || 0;\n    };\n  }\n  var moveCurrent = 0;\n  var movePrevious = 20;\n  chartDeptByTypeCurrent\n    // .dimension(deptByTypeDim)\n    .gap(30)\n    .centerBar(true)\n    .elasticX(true)\n    .ordinalColors(d3.schemeOranges[7])\n    .on(\"pretransition\", function (chart) {\n      chart.selectAll(\"rect.bar\").style(\"width\", function (d) {\n        return \"30px\";\n      });\n    })\n    .title(function (d) {\n      return (\n        currentYr +\n        \" \" +\n        d.key +\n        \"[\" +\n        this.layer +\n        \"] \" +\n        d.value.current[this.layer]\n      );\n    })\n    .group(deptByTypeGroup, depts[0], sel_stack(depts[0], \"current\"));\n\n  for (var i = 1; i < lengthDepts; ++i) {\n    chartDeptByTypeCurrent.stack(\n      deptByTypeGroup,\n      \"\" + depts[i],\n      sel_stack(depts[i], \"current\")\n    );\n  }\n  chartDeptByTypePrevious\n    .title(function (d) {\n      return (\n        previousYr +\n        \" \" +\n        d.key +\n        \"[\" +\n        this.layer +\n        \"] \" +\n        d.value.previous[this.layer]\n      );\n    })\n    .centerBar(true)\n    .ordinalColors(d3.schemeGreens[7])\n    .elasticX(true)\n\n    .group(deptByTypeGroup, depts[0], sel_stack(depts[0], \"previous\"));\n  // .centerBar(true)\n\n  for (var i = 1; i < lengthDepts; ++i) {\n    chartDeptByTypePrevious.stack(\n      deptByTypeGroup,\n      \"\" + depts[i],\n      sel_stack(depts[i], \"previous\")\n    );\n  }\n  chartDeptByTypeTwoYears\n    .height(200)\n    .xAxisPadding(200)\n    .shareTitle(false)\n    .legend(\n      dc\n        .legend()\n        .x(1000)\n        .y(0)\n        .autoItemWidth(true)\n        .itemHeight(10)\n        .itemWidth(100)\n        .gap(5)\n        .horizontal(true)\n    )\n    ._rangeBandPadding(4)\n    .x(d3.scaleBand())\n    .xUnits(dc.units.ordinal)\n    .dimension(deptByTypeDim)\n    .group(deptByTypeGroup)\n    .brushOn(true)\n    .elasticY(true)\n\n    .xAxisPadding(true)\n    .brushOn(false)\n    .compose([chartDeptByTypePrevious, chartDeptByTypeCurrent]);\n\n  //Department by Person Composite\n  chartDeptByPersonCurrent\n    // .dimension(deptByPersonDim)\n    .gap(30)\n    .centerBar(true)\n    .renderLabel(false)\n    .ordinalColors(d3.schemeOranges[7])\n    .on(\"pretransition\", function (chart) {\n      chart.selectAll(\"rect.bar\").style(\"width\", function (d) {\n        return \"30px\";\n      });\n    })\n    .title(function (d) {\n      return (\n        currentYr +\n        \" \" +\n        d.key +\n        \"[\" +\n        this.layer +\n        \"] \" +\n        d.value.current[this.layer]\n      );\n    })\n    .group(deptByPersonGroup, depts[0], sel_stack(depts[0], \"current\"));\n  // .centerBar(true)\n\n  for (var i = 1; i < lengthDepts; ++i) {\n    chartDeptByPersonCurrent.stack(\n      deptByPersonGroup,\n      \"\" + depts[i],\n      sel_stack(depts[i], \"current\")\n    );\n  }\n\n  chartDeptByPersonPrevious\n\n    .ordinalColors(d3.schemeGreens[7])\n    .centerBar(true)\n\n    .title(function (d) {\n      return (\n        previousYr +\n        \" \" +\n        d.key +\n        \"[\" +\n        this.layer +\n        \"] \" +\n        d.value.previous[this.layer]\n      );\n    })\n    .group(deptByPersonGroup, depts[0], sel_stack(depts[0], \"previous\"));\n  // .centerBar(true)\n\n  for (var i = 1; i < lengthDepts; ++i) {\n    chartDeptByPersonPrevious.stack(\n      deptByPersonGroup,\n      \"\" + depts[i],\n      sel_stack(depts[i], \"previous\")\n    );\n  }\n  chartDeptByPersonTwoYears\n    .height(200)\n    .shareTitle(false)\n    .legend(\n      dc\n        .legend()\n        .x(1000)\n        .y(0)\n        .autoItemWidth(true)\n        .itemHeight(10)\n        .itemWidth(100)\n        .gap(5)\n        .horizontal(true)\n    )\n    ._rangeBandPadding(4)\n    .x(d3.scaleBand())\n    .xUnits(dc.units.ordinal)\n\n    .dimension(deptByPersonDim)\n    .group(deptByPersonGroup)\n    .brushOn(true)\n    .elasticY(true)\n\n    .xAxisPadding(true)\n    .brushOn(false)\n    .compose([chartDeptByPersonPrevious, chartDeptByPersonCurrent]);\n\n  overviewCurrent\n    .colors(currentColor)\n    .group(monthGroup, \"\" + currentYr)\n    .curve(d3.curveMonotoneX)\n    .renderLabel(false)\n    .valueAccessor(function (d) {\n      return d.value.current;\n    });\n\n  overviewPrevious\n    .colors(previousColor)\n    .curve(d3.curveMonotoneX)\n    .renderLabel(false)\n    .group(monthGroup, \"\" + previousYr)\n    .valueAccessor(function (d) {\n      return d.value.previous;\n    });\n\n  overviewComposite\n    .height(150)\n    .renderHorizontalGridLines(true)\n    .renderVerticalGridLines(true)\n    .x(d3.scaleOrdinal())\n    .xUnits(dc.units.ordinal)\n    // .legend(dc.legend().x(50).y(20).itemHeight(20).gap(5).horizontal(true))\n    .dimension(monthDim)\n    .group(monthGroup)\n    .elasticX(true)\n    .elasticY(true)\n    ._rangeBandPadding(1)\n    .brushOn(false)\n    .title(function (d) {\n      var obj =\n        currentYr +\n        \": \" +\n        d.value.current +\n        \"\\n\" +\n        previousYr +\n        \": \" +\n        d.value.previous;\n      return obj;\n    })\n    .compose([overviewCurrent, overviewPrevious]);\n\n  chartCallsByType\n    .dimension(typeDim)\n    .renderLabel(true)\n    .elasticX(true)\n    .group(typeGroup)\n    .height(threeChartHeight)\n    .x(d3.scaleOrdinal());\n\n  chartAllCalls\n    .dimension(allCallsDim)\n    .ordinalColors([previousColor, currentColor])\n    .legend(dc.legend().x(50).y(20).itemHeight(20).gap(5).horizontal(true))\n    .fixedBarHeight(25)\n    .renderLabel(true)\n    .elasticX(true)\n    .group(allCallsGroup)\n    .height(125)\n    .x(d3.scaleOrdinal());\n\n  chartCallsByPerson\n    .dimension(createdByDim)\n    .group(createdByGroup)\n    .innerRadius(50)\n    .height(200)\n    .slicesCap(5)\n    .ordinalColors(d3.schemePaired)\n    .legend(\n      dc.legend().legendText(function (d) {\n        // console.log(d);\n        return d.name + \" || \" + numFormat(d.data);\n      })\n    )\n    .title(function (d) {\n      return numFormat(d.value);\n    })\n    .on(\"pretransition\", function (chart) {\n      chart.selectAll(\"text.pie-slice\").text(function (d) {\n        var a = d.data.key;\n        var v = d.data.value;\n        // var label = a ? \"Canceled\" : \"Not Canceled\";\n        return dc.utils.printSingleValue(\n          d3.format(\".0%\")((d.endAngle - d.startAngle) / (2 * Math.PI))\n        );\n      });\n    });\n\n  chartCallsByDept\n    .dimension(deptDim)\n    .group(deptGroup)\n    .innerRadius(50)\n    .height(200)\n    .title(function (d) {\n      return numFormat(d.value);\n    })\n    .slicesCap(5)\n    .ordinalColors(d3.schemeTableau10)\n    .legend(\n      dc.legend().legendText(function (d) {\n        // console.log(d);\n        return d.name + \" || \" + numFormat(d.data);\n      })\n    )\n    .on(\"pretransition\", function (chart) {\n      chart.selectAll(\"text.pie-slice\").text(function (d) {\n        var a = d.data.key;\n        var v = d.data.value;\n        // var label = a ? \"Canceled\" : \"Not Canceled\";\n        return dc.utils.printSingleValue(\n          d3.format(\".0%\")((d.endAngle - d.startAngle) / (2 * Math.PI))\n        );\n      });\n    });\n  var monthNames = [\n    \"Jan\",\n    \"Feb\",\n    \"Mar\",\n    \"Apr\",\n    \"May\",\n    \"Jun\",\n    \"Jul\",\n    \"Aug\",\n    \"Sep\",\n    \"Oct\",\n    \"Nov\",\n    \"Dec\",\n  ];\n\n  overviewComposite.xAxis().tickFormat(function (m) {\n    return monthNames[m];\n  });\n  chartDeptByPersonTwoYears.yAxis().tickFormat(function (n) {\n    return numFormatLg(n);\n  });\n  overviewComposite.yAxis().tickFormat(function (n) {\n    return numFormatLg(n);\n  });\n  chartDeptByTypeTwoYears.yAxis().tickFormat(function (n) {\n    return numFormatLg(n);\n  });\n  overviewComposite.clipPadding(100);\n  dc.renderAll();\n};\n\n// window.loadData(theData);\n"]}